#!/usr/bin/env ruby

require "rubygems"
require "bundler/setup"
require_relative "../lib/nist_pubid"
require "thor"
require "csv"

class NistPubidCLI < Thor
  desc "report", "Create report for nist tech pubs database"
  option :csv, type: :boolean, desc: "Export to CSV format"
  def report
    if options[:csv]
      NistPubid::NistTechPubs.status.each do |row|
        puts [row[3] == row[0] ? "-" : "+",  row[3], row[0], row[1], row[2]]
          .to_csv
      end
    else
      puts "Changed | New PubID | Document ID | DOI | Title + subtitle"
      NistPubid::NistTechPubs.status.each do |row|
        puts "#{row[3] == row[0] ? ' -' : 'âœ…'} | #{row[3]} | #{row[0]} |"\
             " #{row[1]} | #{row[2]}"
      end
    end
  end

  desc "convert", "Convert old document ID to new PubID"
  option :style, aliases: "-s", type: :string, desc: "Convert to short|long|mr style",
                 default: "short"
  def convert(code)
    puts NistPubid::Document.parse(code).to_s(options[:style].to_sym) unless code.empty?
  end
end

NistPubidCLI.start(ARGV)
